<app-sidebar></app-sidebar>
<section class="events-page ml-side section-full mr-2">
    <div class="mx-auto pt-[10px]">
        <div
          class="bg-main-trans2-gradient-90 header-tab py-[10px] mb-0 rounded-[20px] w-fit pr-4 mx-auto"
        >
          <div class="title-group grid-cols-3 grid items-center w-full">
              <div class="tetle-items flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"><path fill="#4F45E5" d="M12.779.025a11.8 11.8 0 0 0-5.338.896A11.8 11.8 0 0 0 3.058 4.11A11.93 11.93 0 0 0 .427 14.363a11.9 11.9 0 0 0 2.3 4.921a11.84 11.84 0 0 0 4.24 3.378a11.78 11.78 0 0 0 10.533-.226a.33.33 0 0 1 .331.018a9.14 9.14 0 0 0 5.197 1.545a.33.33 0 0 0 .332-.332v-4.038a.334.334 0 0 0-.276-.331a4.7 4.7 0 0 1-1.106-.319a.33.33 0 0 1-.191-.352a.3.3 0 0 1 .05-.133a11.94 11.94 0 0 0 .772-11.871a11.87 11.87 0 0 0-4.042-4.628A11.8 11.8 0 0 0 12.765.018zM4.843 11.898a7.24 7.24 0 0 1 1.205-4.005a7.2 7.2 0 0 1 3.215-2.657a7.13 7.13 0 0 1 7.815 1.558a7.24 7.24 0 0 1 1.555 7.854a7.2 7.2 0 0 1-2.643 3.234a7.15 7.15 0 0 1-9.049-.896a7.23 7.23 0 0 1-2.103-5.089z"/></svg>
                <h2 class="title-tab text-3xl font-bold text-indigo-600">
                uiz
                </h2>
              </div>

              <div class="title-tab text-main-trans font-bold w-fit">
                  <!-- –í—ã–±–æ—Ä –ª–µ–Ω–¥–∏–Ω–≥–∞ -->
                  <div class="flex items-center gap-4">
                    <label class="title-tab text-lg font-bold ml-8"> –í—ã–±–µ—Ä–∏—Ç–µ –ª–µ–Ω–¥–∏–Ω–≥: üëâ</label>
                    <select
                      class="select select-primary text-xl rounded-[25px] w-96 max-w-full"
                      [(ngModel)]="selectedLandingId"
                      (ngModelChange)="onLandingChange($event)"
                      [disabled]="loadingLandings"
                    >
                      <option [ngValue]="null">–í—Å–µ –ª–µ–Ω–¥–∏–Ω–≥–∏</option>
                      <option *ngFor="let landing of landings" [ngValue]="landing.id">
                        {{ landing.name }} ({{ landing.quizCount }}) ‚Äî {{ landing.url }}
                      </option>
                    </select>
                  </div>
              </div>

              <!-- –ö–Ω–æ–ø–∫–∏ –≤ —à–∞–ø–∫–µ -->
              <div class="ml-auto flex gap-4">
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º -->
                <button 
                  *ngIf="!editingQuizId"
                  class="btn btn-accent flex items-center gap-2"
                  (click)="startCreate()"
                  [disabled]="loading"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"><g stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path fill="#fff" fill-opacity="0" stroke-dasharray="60" d="M3 12c0 -4.97 4.03 -9 9 -9c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9c-4.97 0 -9 -4.03 -9 -9Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.6s" values="60;0"/><animate fill="freeze" attributeName="fill-opacity" begin="0.6s" dur="0.15s" to="0.3"/></path><g fill="none" stroke-dasharray="12" stroke-dashoffset="12"><path d="M7 12h10"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.85s" dur="0.2s" to="0"/></path><path d="M12 7v10"><animate fill="freeze" attributeName="stroke-dashoffset" begin="1.05s" dur="0.2s" to="0"/></path></g></g></svg>
                  <span class="text-xl text-white">–ù–æ–≤—ã–π –∫–≤–∏–∑</span>
                </button>
              </div>
          </div>
        </div>

        <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–±—ã—Ç–∏–π -->
        <div
          class="card-wrapper h-auto"
        >
          <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
          <div 
            *ngIf="editingQuizId !== null"
            class="fixed inset-0 bg-base-300/80 z-50 flex items-start justify-center overflow-hidden pb-16 w-full"
          >
            <app-quiz-form
              [mode]="editingQuizId === -1 ? 'create' : 'edit'"
              [initialData]="editingQuiz"
              [landings]="landings"
              (save)="saveQuiz($event)"
              (cancel)="cancelEdit()"
              [isEditLoad]="isEditLoad"
              class="w-full"
            ></app-quiz-form>
          </div>

          <!-- –°–ø–∏—Å–æ–∫ –∫–≤–∏–∑–æ–≤ ‚Äî –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º -->
          <div 
              *ngIf="editingQuizId === null && !loading && filteredQuizzes.length > 0"
              class="card-wrapper rounded-[20px] px-6 pt-8 pb-12 min-h-[89dvh] bg-main-trans-gradient-0"
            >
            
            <!-- –ì—Ä—É–ø–ø—ã –ø–æ –ª–µ–Ω–¥–∏–Ω–≥–∞–º -->
            <div *ngFor="let group of quizzesByLanding" class="mb-10">
              
              <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ª–µ–Ω–¥–∏–Ω–≥–∞ -->
              <div class="landing-header bg-indigo-600/10 border border-indigo-300 rounded-xl px-4 py-3 mb-4 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4F46E5" stroke-width="2">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                </svg>
                <div>
                  <div class="text-lg font-bold text-indigo-700">{{ group.landing.name }}</div>
                  <a [href]="'https://' + group.landing.url" 
                    target="_blank" 
                    class="text-sm text-indigo-500 hover:underline">
                    {{ group.landing.url }}
                  </a>
                </div>
                <span class="ml-auto badge badge-primary">{{ group.quizzes.length }} –∫–≤–∏–∑–æ–≤</span>
              </div>
              
              <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–≤–∏–∑–æ–≤ —ç—Ç–æ–≥–æ –ª–µ–Ω–¥–∏–Ω–≥–∞ -->
              <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <div *ngFor="let quiz of group.quizzes" 
                    class="card bg-base-100 shadow-xl hover:shadow-2xl transition-all">
                  <app-quiz-preview
                    [quiz]="quiz"
                    (onEdit)="startEdit(quiz)"
                  ></app-quiz-preview>
                </div>
              </div>
              <div *ngIf="isEditLoad" class="text-center py-20 text-3xl font-bold text-indigo-700">
                <app-loading></app-loading>
              </div>
              
            </div>
          </div>

          <div *ngIf="!loading && !editingQuizId && filteredQuizzes.length === 0" class="text-center py-20 text-3xl font-bold text-indigo-700">
             –ó–∞–≥—Ä—É–∑–∫–∞...
             <app-loading></app-loading>
          </div>
        </div>
    </div>
</section>
 <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ -->
    <div
      *ngIf="resultMessage"
      class="alert mb-4 relative flex justify-between bg-primary text-white"
    >
      <b>{{ resultMessage }}</b>
      <span class="close cursor-pointer" (click)="cancelMessage()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
        >
          <path
            fill="currentColor"
            d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10s10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m3.59-13L12 10.59L8.41 7L7 8.41L10.59 12L7 15.59L8.41 17L12 13.41L15.59 17L17 15.59L13.41 12L17 8.41z"
          />
        </svg>
      </span>
    </div>
